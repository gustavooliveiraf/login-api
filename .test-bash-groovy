#!/bin/sh

if [ "$(docker ps -aq -f name=login-api)" ]; then
    if [ "$(docker ps -aq -f status=running -f name=login-api)" ]; then
        echo passou cima
        docker stop login-api
        docker rm -f login-api
    else
        echo passou meio
        docker rm -f login-api
    fi
fi

docker run -d -p 82:80 -v /var/lib/jenkins/workspace/login-api/.env:/api/.env --name=login-api ${image}

docker exec -i login-api npm run test:cloud
exit_code=$?

docker stop login-api
docker rm -f login-api

if [ $exit_code -ne 0 ]; then
	echo passou cimaaaaaaaaaaaaaa
	exit 1
else
	echo passou baixooooooooooooo
fi
